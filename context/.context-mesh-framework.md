# Context Mesh Framework Reference

> **For AI Agents**: This file contains the framework rules and patterns. Load this file when working with Context Mesh projects.

---

## Framework Overview

**Context Mesh** is a 3-step framework for AI-First development:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INTENT    â”‚ â”€â”€â–º â”‚    BUILD    â”‚ â”€â”€â–º â”‚    LEARN    â”‚
â”‚  What & Why â”‚     â”‚  AI + Human â”‚     â”‚   Update    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. **Intent** - Define what to build and why (create context)
2. **Build** - AI generates code following context (human supervises)
3. **Learn** - Update context with outcomes (refine and improve)

**Key Principle**: Context is primary. Code is its manifestation.

---

## File Type Separation Rules (CRITICAL)

### Feature Files (`context/intent/feature-*.md`)

**MUST contain:**
- **What** - Description of what the feature does
- **Why** - Business/user value, problem it solves
- **Acceptance Criteria** - Functional requirements (what must work)
- **Related** - Links to project intent and decisions

**MUST NOT contain:**
- âŒ Technical implementation details (â†’ `decisions/`)
- âŒ Code patterns or examples (â†’ `knowledge/patterns/`)
- âŒ Step-by-step execution instructions (â†’ `agents/`)
- âŒ Definition of Done (â†’ `agents/` or feature DoD section if needed)

**Example structure:**
```markdown
# Intent: Feature - [Name]

## What
[What this feature does]

## Why
[Why we need it - business/user value]

## Acceptance Criteria
- [ ] Criterion 1
- [ ] Criterion 2

## Related
- [Project Intent](project-intent.md)
- [Decision: [Name]](../decisions/[number]-[name].md)
```

---

### Decision Files (`context/decisions/*.md`)

**MUST contain:**
- **Context** - Situation, requirements, constraints
- **Decision** - Technical choice/approach selected
- **Rationale** - Why this approach was chosen
- **Alternatives Considered** - Other options evaluated and why not chosen
- **Outcomes** - What happened after implementation (updated in Learn step)
- **Related** - Links to features, project intent, other decisions

**MUST NOT contain:**
- âŒ Feature requirements (â†’ `intent/feature-*.md`)
- âŒ Code examples or patterns (â†’ `knowledge/patterns/`)
- âŒ Execution steps (â†’ `agents/`)

**Example structure:**
```markdown
# Decision: [Name]

## Context
[Situation and requirements]

## Decision
[Technical approach chosen]

## Rationale
[Why this approach]

## Alternatives Considered
- [Alternative 1] - [Why not chosen]
- [Alternative 2] - [Why not chosen]

## Outcomes
[Updated after implementation]

## Related
- [Feature: [Name]](../intent/feature-[name].md)
- [Project Intent](../intent/project-intent.md)
```

---

### Knowledge Files (`context/knowledge/patterns/*.md` and `anti-patterns/*.md`)

**MUST contain:**
- **Description** - What the pattern/anti-pattern is
- **When to Use** - Specific scenarios (for patterns)
- **Why it's problematic** - For anti-patterns
- **Examples** - Code examples showing the pattern
- **Related** - Links to decisions that use this pattern

**MUST NOT contain:**
- âŒ Feature requirements (â†’ `intent/`)
- âŒ Technical decisions (â†’ `decisions/`)
- âŒ Execution steps (â†’ `agents/`)

---

### Agent Files (`context/agents/agent-*.md`)

**MUST contain:**
- **Purpose** - What this agent does
- **Context Files to Load** - Which context files to reference
- **Execution Steps** - Step-by-step instructions
- **Definition of Done** - Technical criteria for completion
- **Scope** - What this agent can/cannot do

**MUST NOT contain:**
- âŒ Feature requirements (â†’ `intent/`)
- âŒ Technical decisions (â†’ `decisions/`)
- âŒ Code patterns (â†’ `knowledge/`)

**Key Principle**: Agents **reference** context, not duplicate it.

---

## Plan, Approve, Execute Pattern (MANDATORY)

**CRITICAL**: When implementing ANY feature, bug fix, or update, you MUST follow this pattern:

### 1. PLAN (Do this first - DO NOT SKIP)

**Before writing any code, you MUST:**

1. **Load framework context:**
   - Load this file (`@context/.context-mesh-framework.md`) if it exists
   - Understand Context Mesh structure and rules

2. **Load relevant context files:**
   - `@context/intent/project-intent.md` (always)
   - `@context/intent/feature-*.md` (for the feature being implemented)
   - `@context/decisions/*.md` (relevant decisions)
   - `@context/knowledge/patterns/*.md` (patterns to follow)
   - `@context/knowledge/anti-patterns/*.md` (what to avoid)

3. **Analyze existing codebase:**
   - Understand current structure
   - Identify existing code related to the feature
   - Check if feature already exists (for updates)

4. **Verify prerequisites:**
   - âœ… ADR (decision file) exists before implementation
   - âœ… Feature intent file exists
   - âœ… Patterns are understood

5. **Create and present the plan:**
   - Explain your implementation approach
   - List ALL files you will create
   - List ALL files you will modify
   - Show code structure/architecture
   - Explain how you'll follow decisions and patterns
   - Present the complete plan clearly

**Example plan presentation:**
```
PLAN for implementing [feature name]:

1. Context loaded:
   - @context/intent/feature-[name].md
   - @context/decisions/[number]-[name].md
   - @context/knowledge/patterns/[pattern].md

2. Approach:
   - [Explain technical approach based on decision]

3. Files to create:
   - [List files]

4. Files to modify:
   - [List files]

5. Structure:
   - [Show architecture/structure]
```

### 2. APPROVE (Wait for user approval - DO NOT SKIP)

**After presenting the plan:**

1. **Ask explicitly:**
   - "Should I proceed with this implementation plan?"
   - "Does this plan look correct?"

2. **DO NOT execute until user approves:**
   - âŒ Do not write any code
   - âŒ Do not create any files
   - âŒ Do not modify anything

3. **If user requests changes:**
   - Update the plan
   - Present updated plan
   - Ask for approval again
   - Repeat until approved

### 3. EXECUTE (Only after approval)

**After user approves:**

1. **Implement according to approved plan:**
   - Follow the plan exactly as approved
   - Create only files from the plan
   - Modify only files from the plan
   - Follow all context files strictly

2. **Respect decisions and patterns:**
   - Follow technical decisions from `decisions/`
   - Use patterns from `knowledge/patterns/`
   - Avoid anti-patterns from `knowledge/anti-patterns/`

3. **Maintain code quality:**
   - Follow existing code style
   - Write clean, maintainable code
   - Add comments where needed

**CRITICAL RULE**: Never skip Plan and Approve steps. Always explain first, wait for approval, then execute.

---

## Context Structure

```
context/
â”œâ”€â”€ .context-mesh-framework.md  # This file (framework rules)
â”œâ”€â”€ intent/                      # Step 1: Intent
â”‚   â”œâ”€â”€ project-intent.md
â”‚   â”œâ”€â”€ feature-*.md
â”‚   â”œâ”€â”€ bug-*.md
â”‚   â””â”€â”€ refactor-*.md
â”œâ”€â”€ decisions/                   # Technical decisions (ADR)
â”‚   â””â”€â”€ 001-*.md, 002-*.md, ...
â”œâ”€â”€ knowledge/                   # Patterns and anti-patterns
â”‚   â”œâ”€â”€ patterns/
â”‚   â””â”€â”€ anti-patterns/
â”œâ”€â”€ agents/                      # Optional: Execution agents
â”‚   â””â”€â”€ agent-*.md
â””â”€â”€ evolution/                   # Step 3: Learn
    â”œâ”€â”€ changelog.md
    â””â”€â”€ learning-*.md
```

---

## When Creating Context Files

### When to CREATE files:

âœ… **DO create when:**
- User explicitly requests (add feature, fix bug, etc.)
- User uses prompts like "add feature", "fix bug", "implement"
- User explicitly requests: "create", "make", "build", "generate"
- Following a Context Mesh prompt (add-feature.md, fix-bug.md, etc.)

### When to NOT create files:

âŒ **DO NOT create when:**
- User asks a question (e.g., "How does X work?", "What is Y?")
- User asks for explanation or clarification
- User asks "What should I do?" or "What's the best approach?"
- User is exploring or learning about the codebase
- User asks for suggestions or recommendations

**When user asks questions:**
1. Answer using context from `@context/` files
2. DO NOT create any markdown files automatically
3. You CAN suggest updating Context Mesh if relevant, but:
   - Use format: "ğŸ’¡ **Suggestion**: Consider updating `@context/decisions/001-tech-stack.md` with this information..."
   - DO NOT create the file - just suggest it
   - Let the user decide if they want to update

---

## Updating Existing Features

When updating an existing feature (not creating new):

1. **Analyze existing code first:**
   - Understand what's already implemented
   - Identify existing files related to the feature

2. **Follow Plan, Approve, Execute:**
   - Plan what needs to change
   - Get approval
   - Make ONLY necessary modifications

3. **Make incremental changes only:**
   - Modify only what needs to change based on updated intent
   - Preserve existing code that doesn't need to change
   - Follow "Changes from Original" section if present in intent file

4. **Update related files:**
   - Update tests, documentation, and related code as needed

---

## Definition of Done (DoD)

**DoD applies to Step 2 (Build) only** - when implementing features.

**Typical DoD Criteria:**
- [ ] Code implemented and working
- [ ] Tests passing (if applicable)
- [ ] Code follows patterns from `@context/knowledge/patterns/`
- [ ] Decisions respected from `@context/decisions/`
- [ ] Context updated after implementation (Context Mesh requirement)
- [ ] Acceptance criteria met (from feature intent)

**DoD can be:**
- In `agent-*.md` files (for agent-based execution)
- In feature intent files (optional DoD section)
- Project-level (defined by team)

---

## Bidirectional Links

**CRITICAL**: Always create bidirectional links between related files:

- Feature files â†’ Decision files
- Decision files â†’ Feature files
- Features â†’ Project Intent
- Decisions â†’ Project Intent

**Link format:**
```markdown
## Related
- [Feature: User Auth](../intent/feature-user-auth.md)
- [Decision: Auth Approach](../decisions/002-auth-approach.md)
- [Project Intent](../intent/project-intent.md)
```

---

## Status Section

**Every context file MUST include a Status section:**

```markdown
## Status
- **Created**: YYYY-MM-DD (Phase: Intent/Build/Learn)
- **Status**: [Status Type]
- **Updated**: YYYY-MM-DD (Phase: Intent/Build/Learn) - [reason] (optional)
```

**Status Types:**
- **Intent Files**: Draft, In Progress, Completed, Deprecated, Resolved
- **Decision Files**: Proposed, Accepted, Superseded, Deprecated
- **Knowledge Files**: Active, Deprecated, Superseded

---

## Key Rules Summary

1. âœ… **Separate concerns** - Features, decisions, knowledge, agents have different purposes
2. âœ… **Always Plan, Approve, Execute** - Never skip planning and approval
3. âœ… **ADR before implementation** - Decision must exist before coding
4. âœ… **Load context first** - Always load relevant context files before implementing
5. âœ… **Update context after** - Always update context in Learn step
6. âœ… **Bidirectional links** - Create links between related files
7. âœ… **Status tracking** - Include status in every context file
8. âŒ **Don't mix concerns** - Don't put decision details in feature files
9. âŒ **Don't skip approval** - Always get user approval before executing
10. âŒ **Don't create files for questions** - Only create when explicitly requested

---

## Related

- [Context Mesh Framework Documentation](../../FRAMEWORK.md)
- [Getting Started Guide](../../GETTING_STARTED.md)
- [Examples](../../examples/)

---

**Remember**: Context is primary. Code is its manifestation. Always plan first, get approval, then execute.
